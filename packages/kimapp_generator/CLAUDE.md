# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

KimappGenerator is a Dart/Flutter code generation package that creates type-safe database models, table structures, and Riverpod widgets from schema definitions. It's part of the larger Kimapp monorepo ecosystem located at `/Users/kim/Development/projects/kimapp/`.

## Development Commands

### Code Generation
```bash
dart run build_runner build --delete-conflicting-outputs    # One-time build with cleanup
dart run build_runner watch --delete-conflicting-outputs    # Watch mode with cleanup
dart run build_runner clean                                 # Clean generated files
```

### Testing
```bash
dart test                                    # Run all tests
dart test test/utils/field_definition_test.dart            # Run specific test
```

### Package Management
This project uses workspace resolution. Dependencies are managed at the monorepo level in `/Users/kim/Development/projects/kimapp/pubspec.yaml`.

## Architecture Overview

### Core Components

1. **Builder Configuration** (`build.yaml`)
   - Defines 4 main builders that run in sequence:
   - `kimapp_schema_builder_generator`: Creates `.schema.dart` files
   - `kimapp_table_generator`: Creates `.table.dart` files  
   - `kimapp_model_generator`: Creates model parts
   - `kimapp_form_generator`: Creates form-related code

2. **Generator Classes** (`lib/src/`)
   - `KimappSchemaGenerator`: Main schema-to-code generator
   - `TableStructureGenerator`: Creates table definition classes
   - `TableModelGenerator`: Creates Freezed model classes
   - `KimappFormGenerator`: Creates form widgets and providers

3. **Schema System**
   - Users define schemas with `@Schema()` annotation extending `KimappSchema`
   - Fields defined using `Field<T>()` with various types and configurations
   - Multiple models can be generated from single schema
   - Special ID field generation with `Field.id<T>().generateAs('CustomId')`

### Generated File Pattern
For input file `user_schema.dart`:
- `user_schema.schema.dart` - Freezed annotated models with JSON serialization
- `user_schema.schema.freezed.dart` - Generated by Freezed (immutable implementations)
- `user_schema.schema.g.dart` - Generated by JSON Serializable
- `user_schema.table.dart` - Table structure constants

### Builder Execution Order
1. Schema builder (creates `.schema.dart`)
2. Table generator (creates `.table.dart`) 
3. Freezed runs on schema files
4. Model/Form generators create additional parts
5. JSON Serializable and Riverpod generators run

## Key Schema Concepts

### Field Types
- Basic: `Field<String>('name')`, `Field<int?>('age')`
- ID: `Field.id<int>('id').generateAs('UserId')` (only once per schema)
- Join: `Field.join<ProfileModel?>().withForeignKey('profile_id')`
- Collections: Prefer `Field<IList<String>>('tags')` over `List<String>`

### Schema Structure
```dart
@Schema(tableName: 'users', className: 'User')
class UserSchema extends KimappSchema {
  final id = Field.id<int>('id').generateAs('UserId');
  final name = Field<String>('name');
  
  @override
  List<Model> get models => [
    Model('UserDetailModel')..inheritAllFromBase(),
  ];
}
```

## Integration Points

- **Kimapp Package**: Main dependency providing schema annotations and base classes
- **Riverpod**: Generated code integrates with Riverpod for state management  
- **Freezed**: Models use Freezed for immutability and code generation
- **JSON Serializable**: Automatic JSON serialization/deserialization
- **Supabase**: Generated table constants work well with Supabase queries

## Generated File Exclusions

Never read or edit these generated file types (they're regenerated):
- `*.freezed.dart`
- `*.g.dart` 
- `*.gr.dart`
- `*.schema.dart` (when generated)
- `*.table.dart` (when generated)

## Example Usage Context

This generator is typically used in Flutter apps that need:
- Type-safe database models
- Automatic form generation
- Riverpod state management widgets
- Supabase integration with proper typing

The generated code follows patterns established in the broader Kimapp ecosystem for consistent development experience across Flutter projects.