# Kimapp Schema Generator - AI Reference Guide

## Core Purpose
Kimapp Schema Generator is a Dart/Flutter package that generates type-safe database models and table structures from simple schema definitions.

## Required Setup
1. Import the package in your schema files:
   ```dart
   import 'package:kimapp/kimapp.dart';
   ```

2. Create regular Dart files for your schemas (e.g., `user_schema.dart`)

3. Each schema file must:
   - Use the `@Schema()` annotation
   - Extend `KimappSchema`
   - Define fields and models

Example file structure:
```
lib/
  ├── src/
  │   ├── feature/
  │   │   ├── user/
  │   │   │   ├── user_schema.dart         // Your schema definition
  │   │   ├── post/
  │   │   │   ├── post_schema.dart         // Your schema definition
  │   │   └── ...
```

The generator will create the following files:
```
lib/
  ├── src/
  │   ├── feature/
  │   │   ├── user/
  │   │   │   ├── user_schema.schema.dart         // Generated
  │   │   │   ├── user_schema.schema.freezed.dart // Generated
  │   │   │   ├── user_schema.schema.g.dart       // Generated
  │   │   └── ...
```

## Key Features
- Database table structure generation
- Dart models with Freezed integration
- Type-safe ID classes
- Table relationships via join fields
- Multiple model variations from single schema

## Essential Usage Example
```dart
@Schema(tableName: 'users', className: 'User')
class UserSchema extends KimappSchema {
  final id = Field.id<int>('id').generateAs('UserId');
  final name = Field<String>('name');
  final email = Field<String?>('email');
  
  @override
  List<Model> get models => [
     Model('UserDetailModel')
      ..table()
      ..inheritAllFromBase(excepts: [name]) // name is not inherited from base model
      ..addFields({
        'createdAt': Field<DateTime>('created_at'),
      }),
  ];
}
```

## Field Types Quick Reference
1. Basic Fields:
   ```dart
   Field<String>('name')        // Required
   Field<String?>('email')      // Optional
   Field<int>('age')           // Numeric
   ```

2. ID Fields:
   ```dart
   Field.id<int>('id').generateAs('UserId')
   ```
   
   **Important Rule**: ID fields can only be defined in one schema. For referencing 
   from other schemas, declare them as normal fields using the generated ID type:
   ```dart
   // In a related schema (e.g., PostSchema)
   Field<UserId?>('user_id')    // References UserId from UserSchema
   ```

3. Join Fields:
   ```dart
   Field.join<ProfileModel?>()
     .withForeignKey('profile_id')
     .withCandidateKey('id')
   ```

4. List Fields:
   **Best Practice**: Prefer using `IList` instead of `List` for collections in schema definitions:
   ```dart
   // Preferred
   Field<IList<String>>('tags')
   
   // Also works, but not preferred
   Field<List<String>>('tags')
   ```

## Common Tasks

### Creating Relationships
```dart
// One-to-one
final profile = Field.join<ProfileModel?>()
  .withForeignKey('profile_id')
  .withCandidateKey('id');

// One-to-many
final posts = Field.join<IList<PostModel>>()
  .withForeignKey('user_id')
  .withCandidateKey('author_id');
```

### Multiple Models
```dart
@override
List<Model> get models => [
  Model('UserDetailModel')
    ..addFields({
      'id': id,
      'fullName': name,
    }),
  Model('UserLiteModel')
    ..inheritAllFromBase()
    ..addFields({
      'displayName': name,
    }),
];
```

## Generated Output Types
- Table classes (field constants)
- ID classes (type-safe identifiers)
- Base model classes (with Freezed)
- Additional model variations

## File Generation Pattern
For each schema file (e.g., `user.dart`), the generator creates:
1. `user.schema.dart` - Contains Freezed annotated classes with JSON serialization
2. `user.schema.freezed.dart` - Generated by Freezed containing immutable implementation
3. `user.schema.g.dart` - Generated by JSON serializable with serialization logic

## Code Generation Commands
```bash
dart run build_runner build    # One-time build
dart run build_runner watch    # Watch mode
```

## Integration with Supabase
The generated models and table structures integrate well with Supabase. Here's a typical usage example:

```dart
// Fetching a user by ID with Supabase
Future<Either<Failure, UserModel>> getUserById(UserId id) {
  return await errorHandler(() async {
    final query = _ref.supabaseClient
        .from(UserModel.table.tableName)
        .select(UserModel.table.selectStatement)
        .eq(UserModel.idKey, id.value);

    final result = await query.single();
    return right(UserModel.fromJson(result));
  });
}
```

This example shows:
- Using the generated table name constants (`UserModel.table.tableName`)
- Leveraging pre-defined select statements (`UserModel.table.selectStatement`)
- Using table field constants for conditions (`UserModel.idKey`)
- Converting the response to your model with the generated `fromJson` method

For more detailed information about specific features or advanced usage, please refer to the full documentation.